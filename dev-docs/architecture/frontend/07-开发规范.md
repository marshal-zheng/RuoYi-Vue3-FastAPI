# 前端开发规范

## 代码风格

### 1. Vue 组件规范

#### 组件命名
```vue
<!-- ✅ 正确: 使用 PascalCase -->
<template>
  <UserList />
  <DeptTree />
  <RoleDialog />
</template>

<!-- ❌ 错误: 使用 kebab-case -->
<template>
  <user-list />
  <dept-tree />
</template>
```

#### 组件选项顺序
```vue
<script setup lang="ts">
// 1. 导入
import { ref, reactive, computed, watch, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { listUser } from '@/api/system/user'

// 2. Props 定义
interface Props {
  userId?: number
  visible: boolean
}
const props = withDefaults(defineProps<Props>(), {
  visible: false
})

// 3. Emits 定义
const emit = defineEmits(['update:visible', 'success'])

// 4. 响应式数据
const loading = ref(false)
const form = reactive({
  userName: '',
  nickName: ''
})

// 5. 计算属性
const fullName = computed(() => {
  return form.userName + ' - ' + form.nickName
})

// 6. 监听器
watch(() => props.userId, (val) => {
  if (val) {
    getUserInfo(val)
  }
})

// 7. 方法
const getUserInfo = async (id: number) => {
  // ...
}

const handleSubmit = () => {
  // ...
}

// 8. 生命周期
onMounted(() => {
  // ...
})
</script>
```

### 2. TypeScript 规范

#### 类型定义
```typescript
// ✅ 正确: 使用 interface 定义对象类型
interface UserInfo {
  userId: number
  userName: string
  nickName: string
  email?: string
}

// ✅ 正确: 使用 type 定义联合类型
type Status = '0' | '1'
type UserRole = 'admin' | 'user' | 'guest'

// ❌ 错误: 使用 any
const user: any = {}

// ✅ 正确: 明确类型
const user: UserInfo = {
  userId: 1,
  userName: 'admin',
  nickName: '管理员'
}
```

#### 函数类型
```typescript
// ✅ 正确: 明确参数和返回值类型
function getUser(userId: number): Promise<UserInfo> {
  return request.get(`/user/${userId}`)
}

// ✅ 正确: 箭头函数
const addUser = async (user: UserForm): Promise<void> => {
  await request.post('/user', user)
}

// ❌ 错误: 缺少类型
function getUser(userId) {
  return request.get(`/user/${userId}`)
}
```

### 3. 命名规范

#### 变量命名
```typescript
// ✅ 正确: 使用 camelCase
const userName = 'admin'
const pageNum = 1
const isLoading = false

// ❌ 错误: 使用其他格式
const user_name = 'admin'
const PageNum = 1
```

#### 常量命名
```typescript
// ✅ 正确: 使用 UPPER_CASE
const MAX_PAGE_SIZE = 100
const DEFAULT_STATUS = '0'
const API_BASE_URL = '/api'

// ❌ 错误
const maxPageSize = 100
```

#### 函数命名
```typescript
// ✅ 正确: 动词开头
const getList = () => {}
const handleSubmit = () => {}
const fetchUserInfo = () => {}
const validateForm = () => {}

// ❌ 错误: 名词开头
const list = () => {}
const submit = () => {}
```

#### 布尔值命名
```typescript
// ✅ 正确: is/has/can 开头
const isLoading = ref(false)
const hasPermission = ref(true)
const canEdit = computed(() => true)

// ❌ 错误
const loading = ref(false)
const permission = ref(true)
```

## 组件开发规范

### 1. 组件结构

```vue
<template>
  <div class="user-list">
    <!-- 搜索栏 -->
    <el-form>
      <!-- ... -->
    </el-form>
    
    <!-- 操作按钮 -->
    <el-row>
      <!-- ... -->
    </el-row>
    
    <!-- 数据表格 -->
    <el-table>
      <!-- ... -->
    </el-table>
    
    <!-- 分页 -->
    <pagination />
    
    <!-- 对话框 -->
    <el-dialog>
      <!-- ... -->
    </el-dialog>
  </div>
</template>

<script setup lang="ts" name="User">
// 组件逻辑
</script>

<style scoped lang="scss">
// 组件样式
</style>
```

### 2. Props 验证

```typescript
// ✅ 正确: 完整的 Props 定义
interface Props {
  userId: number                    // 必填
  userName?: string                 // 可选
  status?: '0' | '1'               // 可选,限定值
  roles?: string[]                  // 可选数组
}

const props = withDefaults(defineProps<Props>(), {
  status: '0',
  roles: () => []
})

// ❌ 错误: 缺少类型定义
const props = defineProps({
  userId: Number,
  userName: String
})
```

### 3. Emits 定义

```typescript
// ✅ 正确: 明确事件类型
interface Emits {
  (e: 'update:visible', value: boolean): void
  (e: 'success', data: UserInfo): void
  (e: 'error', error: Error): void
}

const emit = defineEmits<Emits>()

// 触发事件
emit('update:visible', false)
emit('success', userInfo)

// ❌ 错误: 未定义类型
const emit = defineEmits(['update:visible', 'success'])
```

### 4. 组件通信

```vue
<!-- 父组件 -->
<template>
  <UserDialog
    v-model:visible="dialogVisible"
    :user-id="currentUserId"
    @success="handleSuccess"
  />
</template>

<script setup lang="ts">
const dialogVisible = ref(false)
const currentUserId = ref<number>()

const handleSuccess = (data: UserInfo) => {
  console.log('操作成功', data)
  dialogVisible.value = false
}
</script>

<!-- 子组件 -->
<script setup lang="ts">
interface Props {
  visible: boolean
  userId?: number
}

const props = defineProps<Props>()

const emit = defineEmits<{
  (e: 'update:visible', value: boolean): void
  (e: 'success', data: UserInfo): void
}>()

const handleSubmit = () => {
  // 提交成功
  emit('success', userInfo)
  emit('update:visible', false)
}
</script>
```

## API 调用规范

### 1. API 文件组织

```typescript
// src/api/system/user.ts

// 类型定义
export interface UserQuery {
  pageNum: number
  pageSize: number
  userName?: string
}

export interface UserForm {
  userId?: number
  userName: string
  nickName: string
}

export interface UserVO {
  userId: number
  userName: string
  nickName: string
}

// API 函数
export function listUser(query: UserQuery) {
  return request({
    url: '/system/user/list',
    method: 'get',
    params: query
  })
}

export function getUser(userId: number) {
  return request({
    url: `/system/user/${userId}`,
    method: 'get'
  })
}

export function addUser(data: UserForm) {
  return request({
    url: '/system/user',
    method: 'post',
    data
  })
}
```

### 2. 在组件中调用

```vue
<script setup lang="ts">
import { listUser, addUser } from '@/api/system/user'
import type { UserQuery, UserForm, UserVO } from '@/api/system/user'

const userList = ref<UserVO[]>([])
const loading = ref(false)

// ✅ 正确: 完整的错误处理
const getList = async () => {
  loading.value = true
  try {
    const res = await listUser(queryParams.value)
    userList.value = res.rows
    total.value = res.total
  } catch (error) {
    console.error('获取列表失败:', error)
  } finally {
    loading.value = false
  }
}

// ❌ 错误: 缺少错误处理
const getList = async () => {
  const res = await listUser(queryParams.value)
  userList.value = res.rows
}
</script>
```

## 样式规范

### 1. 使用 Scoped

```vue
<!-- ✅ 正确: 使用 scoped -->
<style scoped lang="scss">
.user-list {
  padding: 20px;
  
  .search-form {
    margin-bottom: 20px;
  }
}
</style>

<!-- ❌ 错误: 未使用 scoped -->
<style lang="scss">
.user-list {
  padding: 20px;
}
</style>
```

### 2. 类名规范

```vue
<template>
  <!-- ✅ 正确: 使用 kebab-case -->
  <div class="user-list">
    <div class="search-form">
      <div class="form-item">
        <!-- ... -->
      </div>
    </div>
  </div>
  
  <!-- ❌ 错误: 使用 camelCase -->
  <div class="userList">
    <div class="searchForm">
      <!-- ... -->
    </div>
  </div>
</template>
```

### 3. 样式嵌套

```scss
// ✅ 正确: 嵌套不超过 3 层
.user-list {
  .search-form {
    .form-item {
      margin-bottom: 10px;
    }
  }
}

// ❌ 错误: 嵌套过深
.user-list {
  .container {
    .wrapper {
      .content {
        .item {
          // 嵌套太深
        }
      }
    }
  }
}
```

## 注释规范

### 1. 组件注释

```vue
<script setup lang="ts" name="User">
/**
 * 用户管理页面
 * 
 * 功能:
 * - 用户列表查询
 * - 用户新增/编辑
 * - 用户删除
 * - 用户状态修改
 */
</script>
```

### 2. 函数注释

```typescript
/**
 * 获取用户列表
 * 
 * @description 根据查询条件获取用户列表,支持分页
 * @param query 查询条件
 * @returns 用户列表和总数
 */
const getList = async (query: UserQuery) => {
  // ...
}

/**
 * 删除用户
 * 
 * @param userId 用户ID
 * @throws {Error} 删除失败时抛出错误
 */
const handleDelete = async (userId: number) => {
  // ...
}
```

### 3. 复杂逻辑注释

```typescript
// ✅ 正确: 解释为什么这样做
// 由于后端返回的时间格式不统一,需要统一转换为 YYYY-MM-DD HH:mm:ss
const formatTime = (time: string) => {
  return dayjs(time).format('YYYY-MM-DD HH:mm:ss')
}

// ❌ 错误: 注释说明了代码在做什么(代码本身已经很清楚)
// 格式化时间
const formatTime = (time: string) => {
  return dayjs(time).format('YYYY-MM-DD HH:mm:ss')
}
```

## 性能优化

### 1. 使用 v-show vs v-if

```vue
<template>
  <!-- ✅ 频繁切换使用 v-show -->
  <div v-show="isVisible">内容</div>
  
  <!-- ✅ 条件很少改变使用 v-if -->
  <div v-if="hasPermission">内容</div>
</template>
```

### 2. 列表渲染优化

```vue
<template>
  <!-- ✅ 正确: 使用唯一 key -->
  <div v-for="item in list" :key="item.id">
    {{ item.name }}
  </div>
  
  <!-- ❌ 错误: 使用 index 作为 key -->
  <div v-for="(item, index) in list" :key="index">
    {{ item.name }}
  </div>
</template>
```

### 3. 计算属性缓存

```vue
<script setup lang="ts">
// ✅ 正确: 使用计算属性(有缓存)
const filteredList = computed(() => {
  return list.value.filter(item => item.status === '0')
})

// ❌ 错误: 使用方法(无缓存)
const getFilteredList = () => {
  return list.value.filter(item => item.status === '0')
}
</script>
```

### 4. 组件懒加载

```typescript
// ✅ 正确: 路由懒加载
const routes = [
  {
    path: '/user',
    component: () => import('@/views/system/user/index.vue')
  }
]

// ❌ 错误: 直接导入
import User from '@/views/system/user/index.vue'
const routes = [
  {
    path: '/user',
    component: User
  }
]
```

## 错误处理

### 1. API 错误处理

```typescript
// ✅ 正确: 完整的错误处理
const handleSubmit = async () => {
  try {
    await addUser(form.value)
    ElMessage.success('新增成功')
    getList()
  } catch (error: any) {
    console.error('新增失败:', error)
    ElMessage.error(error.message || '新增失败')
  }
}

// ❌ 错误: 缺少错误处理
const handleSubmit = async () => {
  await addUser(form.value)
  ElMessage.success('新增成功')
}
```

### 2. 表单验证

```vue
<script setup lang="ts">
const formRef = ref()

const rules = {
  userName: [
    { required: true, message: '请输入用户名', trigger: 'blur' },
    { min: 2, max: 20, message: '长度在 2 到 20 个字符', trigger: 'blur' }
  ],
  email: [
    { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }
  ]
}

const handleSubmit = () => {
  formRef.value?.validate((valid: boolean) => {
    if (valid) {
      // 提交表单
    } else {
      ElMessage.warning('请填写完整信息')
      return false
    }
  })
}
</script>
```

## Git 提交规范

### 1. 提交信息格式

```
<type>(<scope>): <subject>

<body>

<footer>
```

### 2. Type 类型

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整(不影响代码运行)
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具相关

### 3. 示例

```
feat(user): 添加用户导出功能

- 实现用户列表导出为 Excel
- 支持按条件筛选导出
- 添加导出权限控制

Closes #123
```

## 代码审查清单

- [ ] 代码符合 Vue 3 规范
- [ ] 使用 TypeScript 类型定义
- [ ] 命名规范清晰
- [ ] 添加必要注释
- [ ] 错误处理完善
- [ ] 使用权限指令
- [ ] 表单验证完整
- [ ] 性能考虑合理
- [ ] 样式使用 scoped
- [ ] 组件可复用性

## 开发工具推荐

### 1. IDE
- VS Code
- WebStorm

### 2. VS Code 插件
- Vue Language Features (Volar)
- TypeScript Vue Plugin (Volar)
- ESLint
- Prettier
- Auto Rename Tag
- Path Intellisense

### 3. 浏览器插件
- Vue.js devtools
- React Developer Tools

## 总结

遵循这些开发规范可以:
- 提高代码质量和可维护性
- 减少 bug 和性能问题
- 提升团队协作效率
- 保持代码风格一致
- 提供更好的开发体验
