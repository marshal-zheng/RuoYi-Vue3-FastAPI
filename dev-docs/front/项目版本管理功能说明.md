# 项目版本管理功能说明

## 功能概述

项目版本管理功能允许用户为每个项目创建、管理和跟踪多个版本，支持版本固化、克隆和删除等操作。

## 数据库部署

### 1. 执行 SQL 脚本

运行以下 SQL 脚本创建版本管理表：

```bash
mysql -u root -p ruoyi-fastapi < ruoyi-fastapi-backend/sql/project.sql
```

或者手动在数据库中执行 `ruoyi-fastapi-backend/sql/project.sql` 文件中的版本管理段落。

### 2. 表结构说明

`sys_project_version` 表包含以下字段：

- `version_id`: 版本ID（主键）
- `project_id`: 项目ID（外键）
- `version_number`: 版本号（如 v1.0.0）
- `version_name`: 版本名称
- `description`: 版本描述
- `status`: 状态（0停用 1启用）
- `is_locked`: 是否固化（0否 1是）
- `locked_time`: 固化时间
- `locked_by`: 固化人
- `create_by`: 创建人
- `create_time`: 创建时间
- `update_by`: 更新者
- `update_time`: 更新时间
- `del_flag`: 删除标志（0存在 2删除）

## 权限配置

需要在系统菜单管理中添加以下权限标识：

- `project:version:list` - 查询版本列表
- `project:version:query` - 查询版本详情
- `project:version:add` - 新增版本
- `project:version:edit` - 编辑版本
- `project:version:remove` - 删除版本

## 功能特性

### 1. 版本列表

- 支持分页显示
- 支持按版本名称搜索
- 支持按日期范围筛选
- 显示版本号、版本名称、描述、创建人、创建时间、状态等信息
- 显示固化状态标识

### 2. 新增版本

- 输入版本号（必填，如 v1.0.0）
- 输入版本名称（必填）
- 输入版本描述（可选）
- 选择状态（启用/停用）
- 自动记录创建人和创建时间

### 3. 编辑版本

- 修改版本号、版本名称、描述和状态
- 固化版本不允许编辑
- 自动记录更新人和更新时间

### 4. 删除版本

- 支持单个删除和批量删除
- 固化版本不允许删除
- 采用逻辑删除，不会真正删除数据

### 5. 固化版本

- 将版本标记为固化状态
- 固化后的版本不能编辑和删除
- 记录固化时间和固化人
- 支持解除固化

### 6. 克隆版本

- 基于现有版本创建新版本
- 复制源版本的描述信息
- 需要输入新的版本号和版本名称
- 克隆的版本状态为正常（未固化）

### 7. 查看版本

- 查看版本的所有详细信息
- 包括固化状态和时间

## API 接口

### 后端接口

所有接口前缀：`/project/version`

1. **获取版本列表**
   - 方法：GET
   - 路径：`/list`
   - 权限：`project:version:list`

2. **获取版本详情**
   - 方法：GET
   - 路径：`/{version_id}`
   - 权限：`project:version:query`

3. **新增版本**
   - 方法：POST
   - 路径：``
   - 权限：`project:version:add`

4. **编辑版本**
   - 方法：PUT
   - 路径：``
   - 权限：`project:version:edit`

5. **删除版本**
   - 方法：DELETE
   - 路径：`/{version_ids}`
   - 权限：`project:version:remove`

6. **克隆版本**
   - 方法：POST
   - 路径：`/clone`
   - 权限：`project:version:add`

7. **固化/解除固化版本**
   - 方法：PUT
   - 路径：`/lock`
   - 权限：`project:version:edit`

### 前端 API

位置：`ruoyi-fastapi-frontend/src/api/project/version.js`

提供以下方法：
- `listProjectVersion(query)` - 查询版本列表
- `getProjectVersion(versionId)` - 查询版本详情
- `addProjectVersion(data)` - 新增版本
- `updateProjectVersion(data)` - 修改版本
- `delProjectVersion(versionId)` - 删除版本
- `cloneProjectVersion(data)` - 克隆版本
- `lockProjectVersion(data)` - 固化/解除固化版本

## 使用流程

### 1. 访问项目详情页

在项目列表中点击某个项目，进入项目详情页面。

### 2. 查看版本列表

项目详情页默认显示"项目版本"标签页，展示该项目的所有版本。

### 3. 创建新版本

1. 点击"新增版本"按钮
2. 填写版本号（如 v1.0.0）
3. 填写版本名称
4. 填写版本描述（可选）
5. 选择状态
6. 点击"保存"

### 4. 编辑版本

1. 在版本列表中点击"编辑"按钮
2. 修改版本信息
3. 点击"保存"

注意：固化版本不能编辑。

### 5. 固化版本

1. 在版本列表中点击"更多操作"
2. 选择"固化版本"
3. 确认操作

固化后的版本将显示"固化"标签，不能再编辑或删除。

### 6. 克隆版本

1. 在版本列表中点击"更多操作"
2. 选择"克隆版本"
3. 输入新版本号和版本名称
4. 点击"克隆"

### 7. 删除版本

1. 在版本列表中点击"更多操作"
2. 选择"删除"
3. 确认操作

或者：
1. 勾选多个版本
2. 点击工具栏的"删除"按钮
3. 确认操作

注意：固化版本不能删除。

## 代码结构

### 后端

```
ruoyi-fastapi-backend/
├── module_admin/
│   ├── controller/
│   │   └── project_version_controller.py    # 版本管理控制器
│   ├── service/
│   │   └── project_version_service.py       # 版本管理服务层
│   ├── dao/
│   │   └── project_version_dao.py           # 版本管理数据访问层
│   └── entity/
│       ├── do/
│       │   └── project_version_do.py        # 版本数据库模型
│       └── vo/
│           └── project_version_vo.py        # 版本视图模型
└── sql/
    └── sys_project_version.sql              # 数据库脚本
```

### 前端

```
ruoyi-fastapi-frontend/
├── src/
│   ├── api/
│   │   └── project/
│   │       └── version.js                   # 版本管理 API
│   └── views/
│       └── project/
│           ├── detail.vue                   # 项目详情页
│           └── components/
│               └── VersionList.vue          # 版本列表组件
```

## 注意事项

1. **版本号唯一性**：同一项目下的版本号必须唯一
2. **固化版本保护**：固化版本不能编辑和删除，确保版本稳定性
3. **权限控制**：所有操作都需要相应的权限
4. **逻辑删除**：删除操作采用逻辑删除，数据不会真正删除
5. **审计日志**：所有操作都会记录操作日志

## 测试建议

1. 测试新增版本功能
2. 测试版本号唯一性验证
3. 测试编辑版本功能
4. 测试固化版本后的保护机制
5. 测试克隆版本功能
6. 测试删除版本功能（包括批量删除）
7. 测试搜索和筛选功能
8. 测试权限控制

## 后续扩展

可以考虑添加以下功能：

1. 版本比较功能
2. 版本回滚功能
3. 版本导出功能
4. 版本统计报表
5. 版本变更历史
6. 版本关联的设备或配置信息
