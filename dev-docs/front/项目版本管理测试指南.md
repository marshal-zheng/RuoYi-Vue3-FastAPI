# 项目版本管理功能测试指南

## 前置条件

### 1. 数据库准备

执行 SQL 脚本创建版本管理表：

```bash
cd ruoyi-fastapi-backend
mysql -u root -p ruoyi-fastapi < sql/sys_project_version.sql
```

### 2. 启动后端服务

```bash
cd ruoyi-fastapi-backend
source venv/bin/activate  # 激活虚拟环境
python app.py --env=dev
```

后端服务将在 http://localhost:8000 启动

### 3. 启动前端服务

```bash
cd ruoyi-fastapi-frontend
yarn dev  # 或 npm run dev
```

前端服务将在 http://localhost:80 启动

## 测试步骤

### 测试 1：查看版本列表

1. 登录系统（用户名：admin，密码：admin123）
2. 进入"工程管理"菜单
3. 点击任意项目的"详情"按钮
4. 查看"项目版本"标签页

**预期结果**：
- 显示版本列表，包含 3 条初始数据
- 显示版本号、版本名称、描述、创建人、创建时间、状态
- v2.0.0 版本显示"固化"标签

### 测试 2：新增版本

1. 在版本列表页面点击"新增版本"按钮
2. 填写以下信息：
   - 版本号：v2.1.0
   - 版本名称：功能优化版
   - 版本描述：优化系统性能，修复已知问题
   - 状态：启用
3. 点击"保存"

**预期结果**：
- 提示"版本新增成功"
- 版本列表自动刷新，显示新增的版本
- 新版本排在列表最前面

### 测试 3：版本号唯一性验证

1. 点击"新增版本"按钮
2. 填写版本号：v2.1.0（与已存在的版本号相同）
3. 填写版本名称：测试版本
4. 点击"保存"

**预期结果**：
- 提示错误信息"版本号 v2.1.0 已存在"
- 版本未创建

### 测试 4：编辑版本

1. 找到 v2.1.0 版本
2. 点击"编辑"按钮
3. 修改版本名称为"性能优化版"
4. 修改描述为"大幅优化系统性能，修复已知问题"
5. 点击"保存"

**预期结果**：
- 提示"版本编辑成功"
- 版本列表自动刷新，显示修改后的信息

### 测试 5：搜索版本

1. 在搜索框中输入"优化"
2. 点击搜索按钮

**预期结果**：
- 显示包含"优化"关键字的版本
- 其他版本被过滤掉

### 测试 6：日期筛选

1. 选择日期范围：2024-02-01 到 2024-02-28
2. 查看筛选结果

**预期结果**：
- 只显示创建时间在该范围内的版本
- v1.1.0 版本应该显示（创建于 2024-02-20）

### 测试 7：固化版本

1. 找到 v2.1.0 版本
2. 点击"更多操作"按钮
3. 选择"固化版本"
4. 确认操作

**预期结果**：
- 提示"版本固化成功"
- 版本列表刷新，v2.1.0 显示"固化"标签
- v2.1.0 的"编辑"按钮变为不可用

### 测试 8：固化版本保护 - 编辑

1. 找到已固化的 v2.0.0 版本
2. 点击"编辑"按钮

**预期结果**：
- 提示"固化版本不允许编辑"
- 无法打开编辑对话框

### 测试 9：固化版本保护 - 删除

1. 找到已固化的 v2.0.0 版本
2. 点击"更多操作"按钮
3. 查看操作列表

**预期结果**：
- "删除"选项不显示或不可用
- 只显示"解除固化"和"克隆版本"选项

### 测试 10：解除固化

1. 找到已固化的 v2.1.0 版本
2. 点击"更多操作"按钮
3. 选择"解除固化"
4. 确认操作

**预期结果**：
- 提示"解除固化成功"
- 版本列表刷新，v2.1.0 不再显示"固化"标签
- v2.1.0 的"编辑"按钮恢复可用

### 测试 11：克隆版本

1. 找到 v2.1.0 版本
2. 点击"更多操作"按钮
3. 选择"克隆版本"
4. 填写以下信息：
   - 版本号：v2.2.0
   - 版本名称：性能优化版_副本
5. 点击"克隆"

**预期结果**：
- 提示"版本克隆成功"
- 版本列表刷新，显示新克隆的 v2.2.0 版本
- v2.2.0 的描述与 v2.1.0 相同
- v2.2.0 状态为正常（未固化）

### 测试 12：删除单个版本

1. 找到 v2.2.0 版本
2. 点击"更多操作"按钮
3. 选择"删除"
4. 确认操作

**预期结果**：
- 提示"删除成功"
- 版本列表刷新，v2.2.0 不再显示

### 测试 13：批量删除版本

1. 勾选 v1.0.0 和 v1.1.0 两个版本
2. 点击工具栏的"删除"按钮
3. 确认操作

**预期结果**：
- 提示"删除成功"
- 版本列表刷新，选中的版本不再显示

### 测试 14：查看版本详情

1. 找到任意版本
2. 点击"查看"按钮

**预期结果**：
- 显示版本详情对话框
- 显示所有版本信息（只读）
- 如果是固化版本，显示固化时间和固化人

### 测试 15：分页功能

1. 创建超过 10 个版本（如果数据不足）
2. 查看分页控件
3. 切换到第 2 页

**预期结果**：
- 分页控件正常显示
- 可以切换页码
- 可以修改每页显示数量

### 测试 16：权限控制

1. 使用没有版本管理权限的用户登录
2. 进入项目详情页

**预期结果**：
- "新增版本"按钮不显示或不可用
- "编辑"、"删除"等操作按钮不显示或不可用

## API 测试

可以使用 Postman 或 curl 测试后端 API：

### 1. 获取版本列表

```bash
curl -X GET "http://localhost:8000/project/version/list?projectId=1&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 新增版本

```bash
curl -X POST "http://localhost:8000/project/version" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "projectId": 1,
    "versionNumber": "v3.0.0",
    "versionName": "测试版本",
    "description": "API测试版本",
    "status": "1"
  }'
```

### 3. 编辑版本

```bash
curl -X PUT "http://localhost:8000/project/version" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "versionId": 4,
    "versionName": "测试版本_修改",
    "description": "修改后的描述"
  }'
```

### 4. 固化版本

```bash
curl -X PUT "http://localhost:8000/project/version/lock" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "versionId": 4,
    "isLocked": "1"
  }'
```

### 5. 克隆版本

```bash
curl -X POST "http://localhost:8000/project/version/clone" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "sourceVersionId": 4,
    "versionNumber": "v3.1.0",
    "versionName": "克隆版本",
    "description": "从v3.0.0克隆"
  }'
```

### 6. 删除版本

```bash
curl -X DELETE "http://localhost:8000/project/version/4" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 常见问题

### 1. 版本列表为空

**原因**：
- 数据库表未创建
- SQL 脚本未执行
- projectId 参数错误

**解决方法**：
- 检查数据库表是否存在
- 重新执行 SQL 脚本
- 确认 projectId 正确

### 2. 提示权限不足

**原因**：
- 用户没有相应权限
- Token 过期

**解决方法**：
- 使用 admin 用户登录
- 在菜单管理中配置权限
- 重新登录获取新 Token

### 3. 固化版本无法编辑

**说明**：这是正常行为，固化版本设计为不可编辑

**解决方法**：
- 先解除固化
- 或者克隆一个新版本进行修改

### 4. 版本号重复

**原因**：同一项目下版本号必须唯一

**解决方法**：
- 使用不同的版本号
- 遵循语义化版本规范（如 v1.0.0, v1.1.0, v2.0.0）

## 测试检查清单

- [ ] 版本列表正常显示
- [ ] 新增版本功能正常
- [ ] 版本号唯一性验证正常
- [ ] 编辑版本功能正常
- [ ] 搜索功能正常
- [ ] 日期筛选功能正常
- [ ] 固化版本功能正常
- [ ] 固化版本保护机制正常
- [ ] 解除固化功能正常
- [ ] 克隆版本功能正常
- [ ] 删除单个版本功能正常
- [ ] 批量删除功能正常
- [ ] 查看版本详情功能正常
- [ ] 分页功能正常
- [ ] 权限控制正常
- [ ] API 接口正常
- [ ] 操作日志记录正常

## 性能测试

### 1. 大数据量测试

创建 100+ 个版本，测试：
- 列表加载速度
- 搜索响应速度
- 分页切换速度

### 2. 并发测试

多个用户同时操作：
- 同时创建版本
- 同时编辑版本
- 同时删除版本

### 3. 压力测试

使用工具（如 JMeter）进行压力测试：
- 每秒 100 次请求
- 持续 5 分钟
- 观察系统响应

## 测试报告模板

```
测试日期：____________________
测试人员：____________________
测试环境：____________________

功能测试结果：
- 版本列表：[ ] 通过 [ ] 失败
- 新增版本：[ ] 通过 [ ] 失败
- 编辑版本：[ ] 通过 [ ] 失败
- 删除版本：[ ] 通过 [ ] 失败
- 固化版本：[ ] 通过 [ ] 失败
- 克隆版本：[ ] 通过 [ ] 失败
- 搜索筛选：[ ] 通过 [ ] 失败
- 权限控制：[ ] 通过 [ ] 失败

发现的问题：
1. ____________________
2. ____________________
3. ____________________

建议改进：
1. ____________________
2. ____________________
3. ____________________
```
