# RuoYi-FastAPI 后端环境变量配置指南

## 文档概述

本文档详细介绍了 RuoYi-FastAPI 后端项目中所有可配置的环境变量和控制参数，包括应用配置、数据库配置、认证配置、文件上传配置等。所有配置都支持通过环境变量(.env文件)进行设置。

## 配置文件结构

### 环境文件命名规则
- `.env.dev` - 开发环境配置
- `.env.prod` - 生产环境配置  
- `.env.test` - 测试环境配置
- `.env.stage` - 预发布环境配置

### 配置加载机制
项目通过命令行参数指定环境：
```bash
python app.py --env=dev    # 加载 .env.dev
python app.py --env=prod   # 加载 .env.prod
python app.py             # 默认加载 .env.dev
```

---

## 1. 应用配置 (AppSettings)

### 基本应用设置

| 环境变量 | 默认值 | 类型 | 说明 | 可选值 |
|---------|--------|------|------|--------|
| `APP_ENV` | `'dev'` | str | 运行环境标识 | `dev`, `prod`, `test`, `stage` |
| `APP_NAME` | `'RuoYi-FasAPI'` | str | 应用名称 | 任意字符串 |
| `APP_ROOT_PATH` | `'/dev-api'` | str | API根路径前缀 | 任意路径字符串 |
| `APP_HOST` | `'0.0.0.0'` | str | 服务器监听地址 | IP地址或域名 |
| `APP_PORT` | `9099` | int | 服务器监听端口 | 1-65535 |
| `APP_VERSION` | `'1.0.0'` | str | 应用版本号 | 语义化版本号 |
| `APP_RELOAD` | `True` | bool | 热重载开关 | `True`, `False` |

### 功能控制开关

| 环境变量 | 默认值 | 类型 | 说明 | 影响功能 |
|---------|--------|------|------|----------|
| `APP_IP_LOCATION_QUERY` | `True` | bool | IP地址归属地查询 | 登录日志地理位置显示 |
| `APP_SAME_TIME_LOGIN` | `True` | bool | **同账号多地登录控制** | `True`:允许同时登录<br>`False`:后登录踢掉前者 |

### 配置示例
```env
# .env.dev - 开发环境
APP_ENV=dev
APP_NAME=RuoYi-FastAPI-Dev
APP_ROOT_PATH=/dev-api
APP_HOST=0.0.0.0
APP_PORT=9099
APP_VERSION=1.0.0
APP_RELOAD=true
APP_IP_LOCATION_QUERY=true
APP_SAME_TIME_LOGIN=true
```

```env
# .env.prod - 生产环境
APP_ENV=prod
APP_NAME=RuoYi-FastAPI
APP_ROOT_PATH=/prod-api
APP_HOST=0.0.0.0
APP_PORT=8080
APP_VERSION=1.0.0
APP_RELOAD=false
APP_IP_LOCATION_QUERY=true
APP_SAME_TIME_LOGIN=false
```

---

## 2. JWT认证配置 (JwtSettings)

### JWT相关配置

| 环境变量 | 默认值 | 类型 | 说明 | 安全建议 |
|---------|--------|------|------|----------|
| `JWT_SECRET_KEY` | `b01c66dc...` | str | JWT签名密钥 | 生产环境必须更换为随机字符串 |
| `JWT_ALGORITHM` | `'HS256'` | str | JWT签名算法 | `HS256`, `HS512`, `RS256` |
| `JWT_EXPIRE_MINUTES` | `1440` | int | JWT令牌过期时间(分钟) | 建议 30-1440 分钟 |
| `JWT_REDIS_EXPIRE_MINUTES` | `30` | int | Redis中JWT缓存时间(分钟) | 建议小于等于JWT过期时间 |

### 配置示例
```env
# 开发环境 - JWT配置
JWT_SECRET_KEY=your_super_secret_key_here_at_least_32_characters_long
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=1440
JWT_REDIS_EXPIRE_MINUTES=30
```

### 安全注意事项
- **生产环境必须更换 JWT_SECRET_KEY**
- 密钥长度至少32位字符
- 建议使用 `openssl rand -hex 32` 生成安全密钥

---

## 3. 数据库配置 (DataBaseSettings)

### 数据库连接配置

| 环境变量 | 默认值 | 类型 | 说明 | 可选值 |
|---------|--------|------|------|--------|
| `DB_TYPE` | `'mysql'` | str | 数据库类型 | `mysql`, `postgresql` |
| `DB_HOST` | `'127.0.0.1'` | str | 数据库主机地址 | IP地址或域名 |
| `DB_PORT` | `3306` | int | 数据库端口 | MySQL:3306, PostgreSQL:5432 |
| `DB_USERNAME` | `'root'` | str | 数据库用户名 | 数据库用户名 |
| `DB_PASSWORD` | `'mysqlroot'` | str | 数据库密码 | 数据库密码 |
| `DB_DATABASE` | `'ruoyi-fastapi'` | str | 数据库名称 | 数据库名称 |

### 数据库连接池配置

| 环境变量 | 默认值 | 类型 | 说明 | 调优建议 |
|---------|--------|------|------|----------|
| `DB_ECHO` | `True` | bool | SQL语句日志输出 | 生产环境设为 `False` |
| `DB_MAX_OVERFLOW` | `10` | int | 连接池最大溢出连接数 | 根据并发需求调整 |
| `DB_POOL_SIZE` | `50` | int | 连接池大小 | 根据数据库服务器配置调整 |
| `DB_POOL_RECYCLE` | `3600` | int | 连接回收时间(秒) | 3600-7200秒 |
| `DB_POOL_TIMEOUT` | `30` | int | 连接超时时间(秒) | 10-60秒 |

### MySQL配置示例
```env
# MySQL数据库配置
DB_TYPE=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_mysql_password
DB_DATABASE=ruoyi_fastapi
DB_ECHO=false
DB_MAX_OVERFLOW=20
DB_POOL_SIZE=50
DB_POOL_RECYCLE=3600
DB_POOL_TIMEOUT=30
```

### PostgreSQL配置示例
```env
# PostgreSQL数据库配置
DB_TYPE=postgresql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=your_postgres_password
DB_DATABASE=ruoyi_fastapi
DB_ECHO=false
DB_MAX_OVERFLOW=20
DB_POOL_SIZE=50
DB_POOL_RECYCLE=3600
DB_POOL_TIMEOUT=30
```

---

## 4. Redis配置 (RedisSettings)

### Redis连接配置

| 环境变量 | 默认值 | 类型 | 说明 | 备注 |
|---------|--------|------|------|------|
| `REDIS_HOST` | `'127.0.0.1'` | str | Redis主机地址 | IP地址或域名 |
| `REDIS_PORT` | `6379` | int | Redis端口 | 默认6379 |
| `REDIS_USERNAME` | `''` | str | Redis用户名 | Redis 6.0+ 支持 |
| `REDIS_PASSWORD` | `''` | str | Redis密码 | 建议设置密码 |
| `REDIS_DATABASE` | `2` | int | Redis数据库编号 | 0-15 |

### 配置示例
```env
# Redis配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_USERNAME=
REDIS_PASSWORD=your_redis_password
REDIS_DATABASE=2
```

### Redis用途说明
- 存储JWT令牌
- 缓存系统配置
- 缓存数据字典
- 存储验证码
- 用户会话管理

---

## 5. 文件上传配置 (UploadSettings)

### 上传路径配置

| 配置项 | 默认值 | 说明 | 注意事项 |
|--------|--------|------|----------|
| `UPLOAD_PREFIX` | `'/profile'` | 上传文件URL前缀 | 用于生成文件访问URL |
| `UPLOAD_PATH` | `'vf_admin/upload_path'` | 文件上传存储路径 | 相对于项目根目录 |
| `UPLOAD_MACHINE` | `'A'` | 上传机器标识 | 用于多机器部署文件区分 |
| `DOWNLOAD_PATH` | `'vf_admin/download_path'` | 文件下载临时目录 | 用于导出文件暂存 |

### 允许的文件类型

```python
DEFAULT_ALLOWED_EXTENSION = [
    # 图片格式
    'bmp', 'gif', 'jpg', 'jpeg', 'png',
    
    # 办公文档
    'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx',
    'html', 'htm', 'txt', 'pdf',
    
    # 压缩文件
    'rar', 'zip', 'gz', 'bz2',
    
    # 视频格式
    'mp4', 'avi', 'rmvb'
]
```

### 环境变量配置（可选）
```env
# 上传配置（通常不需要修改）
UPLOAD_PREFIX=/profile
UPLOAD_PATH=vf_admin/upload_path
UPLOAD_MACHINE=A
DOWNLOAD_PATH=vf_admin/download_path
```

---

## 6. 代码生成配置 (GenSettings)

### 代码生成器配置

| 配置项 | 默认值 | 说明 | 可修改性 |
|--------|--------|------|----------|
| `author` | `'insistence'` | 代码作者信息 | 可修改 |
| `package_name` | `'module_admin.system'` | 生成代码包名 | 可修改 |
| `auto_remove_pre` | `False` | 自动移除表前缀 | 可修改 |
| `table_prefix` | `'sys_'` | 表前缀 | 可修改 |
| `allow_overwrite` | `False` | 允许覆盖已存在文件 | 可修改 |
| `GEN_PATH` | `'vf_admin/gen_path'` | 代码生成输出路径 | 可修改 |

### 配置方式
这些配置通常在代码中直接修改，不通过环境变量设置：

```python
# config/env.py 中的 GenSettings 类
class GenSettings:
    author = 'your_name'  # 修改为你的名字
    package_name = 'module_admin.system'
    auto_remove_pre = True  # 是否自动移除表前缀
    table_prefix = 'sys_'   # 数据库表前缀
    allow_overwrite = False # 是否允许覆盖文件
```

---

## 7. 系统常量配置

### 业务操作类型 (BusinessType)

```python
class BusinessType(Enum):
    OTHER = 0      # 其它
    INSERT = 1     # 新增
    UPDATE = 2     # 修改
    DELETE = 3     # 删除
    GRANT = 4      # 授权
    EXPORT = 5     # 导出
    IMPORT = 6     # 导入
    FORCE = 7      # 强退
    GENCODE = 8    # 生成代码
    CLEAN = 9      # 清空数据
```

### Redis键名配置 (RedisInitKeyConfig)

| 键名 | 用途 | 说明 |
|------|------|------|
| `access_token` | 登录令牌信息 | 存储用户JWT令牌 |
| `sys_dict` | 数据字典 | 缓存系统字典数据 |
| `sys_config` | 配置信息 | 缓存系统配置参数 |
| `captcha_codes` | 图片验证码 | 存储验证码信息 |
| `account_lock` | 用户锁定 | 记录被锁定的用户账号 |
| `password_error_count` | 密码错误次数 | 统计密码输入错误次数 |
| `sms_code` | 短信验证码 | 存储短信验证码 |

### HTTP状态码配置

| 状态码 | 说明 | 用途 |
|--------|------|------|
| 200 | 操作成功 | 正常响应 |
| 400 | 参数错误 | 请求参数有误 |
| 401 | 未授权 | 需要登录认证 |
| 403 | 访问受限 | 权限不足 |
| 404 | 资源未找到 | 请求的资源不存在 |
| 500 | 系统内部错误 | 服务器错误 |

---

## 8. 系统配置项 (sys_config表)

### 内置系统配置

| 配置键 | 配置名称 | 默认值 | 说明 |
|--------|----------|--------|------|
| `sys.index.skinName` | 主框架页-默认皮肤样式名称 | `skin-blue` | 系统主题样式 |
| `sys.user.initPassword` | 用户管理-账号初始密码 | `123456` | 新用户默认密码 |
| `sys.index.sideTheme` | 主框架页-侧边栏主题 | `theme-dark` | 侧边栏主题 |
| `sys.account.captchaEnabled` | 账号自助-验证码开关 | `true` | 是否启用验证码 |
| `sys.account.registerUser` | 账号自助-是否开启用户注册功能 | `false` | 是否允许用户注册 |
| `sys.login.blackIPList` | 用户登录-黑名单列表 | `''` | 登录IP黑名单 |

### 配置项详细说明

#### 验证码控制
```env
# 通过环境变量或数据库配置
sys.account.captchaEnabled=true   # 启用验证码
sys.account.captchaEnabled=false  # 禁用验证码
```

#### 用户注册控制
```env
sys.account.registerUser=true     # 允许用户注册
sys.account.registerUser=false    # 禁止用户注册
```

#### IP黑名单配置
```env
# 支持通配符和网段
sys.login.blackIPList=192.168.1.*;10.0.0.0/24;172.16.*
```

---

## 9. 完整的环境配置示例

### 开发环境 (.env.dev)
```env
# 应用配置
APP_ENV=dev
APP_NAME=RuoYi-FastAPI-Dev
APP_ROOT_PATH=/dev-api
APP_HOST=0.0.0.0
APP_PORT=9099
APP_VERSION=1.0.0
APP_RELOAD=true
APP_IP_LOCATION_QUERY=true
APP_SAME_TIME_LOGIN=true

# JWT配置
JWT_SECRET_KEY=dev_secret_key_please_change_in_production_32_chars
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=1440
JWT_REDIS_EXPIRE_MINUTES=30

# MySQL数据库配置
DB_TYPE=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=mysqlroot
DB_DATABASE=ruoyi_fastapi
DB_ECHO=true
DB_MAX_OVERFLOW=10
DB_POOL_SIZE=20
DB_POOL_RECYCLE=3600
DB_POOL_TIMEOUT=30

# Redis配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_DATABASE=2
```

### 生产环境 (.env.prod)
```env
# 应用配置
APP_ENV=prod
APP_NAME=RuoYi-FastAPI
APP_ROOT_PATH=/prod-api
APP_HOST=0.0.0.0
APP_PORT=8080
APP_VERSION=1.0.0
APP_RELOAD=false
APP_IP_LOCATION_QUERY=true
APP_SAME_TIME_LOGIN=false

# JWT配置 - 生产环境必须使用安全密钥
JWT_SECRET_KEY=prod_super_secure_secret_key_with_at_least_32_characters_random_string
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=720
JWT_REDIS_EXPIRE_MINUTES=30

# MySQL数据库配置
DB_TYPE=mysql
DB_HOST=your-db-host.com
DB_PORT=3306
DB_USERNAME=ruoyi_user
DB_PASSWORD=your_secure_db_password
DB_DATABASE=ruoyi_fastapi_prod
DB_ECHO=false
DB_MAX_OVERFLOW=20
DB_POOL_SIZE=50
DB_POOL_RECYCLE=3600
DB_POOL_TIMEOUT=30

# Redis配置
REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_USERNAME=
REDIS_PASSWORD=your_secure_redis_password
REDIS_DATABASE=0
```

---

## 10. 配置最佳实践

### 安全配置建议

1. **JWT密钥安全**
   ```bash
   # 生成安全的JWT密钥
   openssl rand -hex 32
   ```

2. **数据库密码安全**
   - 使用强密码
   - 定期更换密码
   - 限制数据库用户权限

3. **Redis安全**
   - 启用密码认证
   - 修改默认端口
   - 配置防火墙规则

### 性能优化配置

1. **数据库连接池**
   ```env
   # 高并发环境
   DB_POOL_SIZE=100
   DB_MAX_OVERFLOW=50
   ```

2. **JWT过期时间**
   ```env
   # 根据安全需求调整
   JWT_EXPIRE_MINUTES=480    # 8小时
   JWT_REDIS_EXPIRE_MINUTES=30
   ```

### 监控和日志配置

1. **SQL日志控制**
   ```env
   # 开发环境启用，生产环境禁用
   DB_ECHO=false
   ```

2. **应用热重载**
   ```env
   # 生产环境必须禁用
   APP_RELOAD=false
   ```

### 环境隔离建议

1. **不同环境使用不同的**：
   - 数据库实例
   - Redis实例
   - JWT密钥
   - API路径前缀

2. **配置文件管理**：
   - 不要将敏感信息提交到版本控制
   - 使用模板文件 `.env.example`
   - 在部署时复制并修改配置

---

## 11. 故障排除

### 常见配置问题

1. **数据库连接失败**
   ```bash
   # 检查配置
   DB_HOST=正确的数据库地址
   DB_PORT=正确的端口
   DB_USERNAME=有效的用户名
   DB_PASSWORD=正确的密码
   ```

2. **Redis连接失败**
   ```bash
   # 检查Redis服务状态
   redis-cli ping
   
   # 检查配置
   REDIS_HOST=127.0.0.1
   REDIS_PORT=6379
   ```

3. **JWT令牌问题**
   ```bash
   # 确保密钥长度足够
   JWT_SECRET_KEY=至少32位字符的密钥
   ```

### 配置验证方法

1. **启动日志检查**
   - 观察应用启动日志
   - 确认数据库连接成功
   - 确认Redis连接成功

2. **API测试**
   - 访问健康检查接口
   - 测试登录功能
   - 验证JWT令牌生成

---

## 12. 总结

本文档涵盖了 RuoYi-FastAPI 后端项目的所有环境变量配置选项，包括：

- **应用基础配置**：端口、主机、API前缀等
- **功能控制开关**：同时登录控制、IP查询等
- **认证配置**：JWT密钥、过期时间等
- **数据库配置**：连接信息、连接池参数
- **Redis配置**：缓存和会话存储
- **文件上传配置**：路径和类型限制
- **系统常量**：业务类型、状态码等

通过合理配置这些参数，可以满足不同环境下的部署需求，确保系统的安全性、性能和稳定性。

---

**文档版本**: v1.0  
**更新时间**: 2024年12月  
**维护人员**: Development Team

> 注意：生产环境部署时，请务必修改默认的JWT密钥和数据库密码，并根据实际需求调整各项配置参数。