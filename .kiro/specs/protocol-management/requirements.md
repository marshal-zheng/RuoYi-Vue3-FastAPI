# 协议管理系统需求文档

## 简介

本文档定义了协议管理系统的需求规范。该系统允许用户管理通信协议库，包括协议的创建、编辑、查询、删除、版本控制和固化管理。协议支持多种通信类型（以太网、RS422、CAN、1553B），每种协议类型具有特定的配置模板和参数。

## 术语表

- **协议管理系统 (Protocol Management System)**: 用于管理通信协议库的完整系统
- **协议 (Protocol)**: 定义设备间通信规则的配置，包含协议名称、类型、版本、状态和详细配置
- **协议类型 (Protocol Type)**: 协议的通信接口类型，包括以太网、RS422、CAN、1553B
- **协议配置 (Protocol Config)**: 特定协议类型的详细技术参数和通信格式定义
- **固化状态 (Lock Status)**: 协议版本的保护状态，固化后的协议不可修改和删除
- **协议版本 (Version)**: 协议的版本标识符
- **用户 (User)**: 具有适当权限的已认证系统用户
- **管理员用户 (Admin User)**: 具有管理协议的管理权限的用户

## 需求

### 需求 1: 协议列表查询与展示

**用户故事:** 作为管理员用户，我希望查看协议列表，以便了解系统中所有协议的概况。

#### 验收标准

1. WHEN 用户导航到协议管理页面时，THE 协议管理系统 SHALL 显示包含协议编号、协议名称、协议类型、版本号、状态、固化状态、创建人和最后修改时间的分页表格
2. WHEN 用户点击协议名称时，THE 协议管理系统 SHALL 导航到协议详情页面
3. WHEN 协议管理系统显示协议状态时，THE 协议管理系统 SHALL 使用字典标签显示"正常"或"停用"状态
4. WHEN 协议管理系统显示固化状态时，THE 协议管理系统 SHALL 对已固化协议显示带锁图标的警告标签，对未固化协议显示带解锁图标的信息标签
5. WHEN 协议管理系统显示最后修改时间时，THE 协议管理系统 SHALL 使用标准日期时间格式 "YYYY-MM-DD HH:mm:ss"
6. WHEN 用户选择表格中的一行或多行时，THE 协议管理系统 SHALL 更新批量操作按钮的启用状态
7. WHEN 协议管理系统加载数据时，THE 协议管理系统 SHALL 显示加载指示器
8. WHEN 协议管理系统加载数据失败时，THE 协议管理系统 SHALL 显示模拟数据以保证页面可用性

### 需求 2: 协议搜索与筛选

**用户故事:** 作为管理员用户，我希望搜索和筛选协议，以便快速找到需要的协议。

#### 验收标准

1. WHEN 用户在搜索框输入协议名称并点击搜索时，THE 协议管理系统 SHALL 按协议名称过滤列表并重置分页到第1页
2. WHEN 用户选择协议类型筛选器时，THE 协议管理系统 SHALL 按选定的协议类型过滤列表并刷新数据
3. WHEN 用户选择日期范围筛选器时，THE 协议管理系统 SHALL 按创建时间范围过滤列表并刷新数据
4. WHEN 用户清除搜索或筛选条件时，THE 协议管理系统 SHALL 显示所有协议并刷新列表
5. WHEN 用户同时应用多个筛选条件时，THE 协议管理系统 SHALL 使用AND逻辑组合所有条件
6. WHEN 协议管理系统显示筛选结果时，THE 协议管理系统 SHALL 在分页信息中显示匹配项的总数

### 需求 3: 新增协议

**用户故事:** 作为管理员用户，我希望创建新协议，以便向系统添加新的通信协议配置。

#### 验收标准

1. WHEN 用户点击"新增"按钮时，THE 协议管理系统 SHALL 打开协议表单抽屉，标题为"新增协议"
2. WHEN 协议管理系统显示新增表单时，THE 协议管理系统 SHALL 提供协议名称、协议类型、版本号、状态和协议描述输入字段
3. WHEN 用户选择协议类型时，THE 协议管理系统 SHALL 在表单下方显示对应协议类型的配置模板区域
4. WHEN 用户提交有效的协议表单时，THE 协议管理系统 SHALL 保存协议数据并关闭抽屉
5. IF 协议保存成功，THEN THE 协议管理系统 SHALL 显示成功消息并刷新协议列表
6. IF 协议保存失败，THEN THE 协议管理系统 SHALL 显示错误消息并保持抽屉打开状态
7. WHEN 用户点击取消按钮时，THE 协议管理系统 SHALL 关闭抽屉并丢弃未保存的更改

### 需求 4: 编辑协议

**用户故事:** 作为管理员用户，我希望编辑现有协议，以便更新协议配置和信息。

#### 验收标准

1. WHEN 用户点击协议行的"编辑"按钮时，THE 协议管理系统 SHALL 打开协议表单抽屉，标题为"编辑协议"
2. WHEN 协议管理系统显示编辑表单时，THE 协议管理系统 SHALL 预填充所有协议字段和配置数据
3. WHEN 协议管理系统加载协议详情时，THE 协议管理系统 SHALL 显示骨架屏加载状态
4. WHEN 用户修改协议信息并提交时，THE 协议管理系统 SHALL 更新协议数据并关闭抽屉
5. IF 协议更新成功，THEN THE 协议管理系统 SHALL 显示成功消息并刷新协议列表
6. WHEN 协议已被固化时，THE 协议管理系统 SHALL 禁用编辑操作或显示只读模式
7. WHEN 用户切换协议类型时，THE 协议管理系统 SHALL 重置协议配置数据并显示新类型的配置模板

### 需求 5: 删除协议

**用户故事:** 作为管理员用户，我希望删除不需要的协议，以便保持协议库的整洁。

#### 验收标准

1. WHEN 用户点击单个协议的"删除"操作时，THE 协议管理系统 SHALL 显示确认对话框，包含协议名称
2. WHEN 用户选择多个协议并点击"删除"按钮时，THE 协议管理系统 SHALL 显示确认对话框，包含选中的协议数量或名称列表
3. IF 用户确认删除，THEN THE 协议管理系统 SHALL 删除选定的协议并刷新列表
4. IF 删除成功，THEN THE 协议管理系统 SHALL 显示成功消息
5. IF 删除失败，THEN THE 协议管理系统 SHALL 显示错误消息
6. WHEN 协议已被固化时，THE 协议管理系统 SHALL 在更多操作菜单中隐藏删除选项
7. WHEN 用户取消删除确认时，THE 协议管理系统 SHALL 关闭对话框且不执行删除操作

### 需求 6: 协议固化管理

**用户故事:** 作为管理员用户，我希望固化重要协议版本，以便防止意外修改或删除。

#### 验收标准

1. WHEN 用户点击未固化协议的更多操作菜单时，THE 协议管理系统 SHALL 显示"固化版本"选项
2. WHEN 用户点击已固化协议的更多操作菜单时，THE 协议管理系统 SHALL 显示"解除固化"选项
3. WHEN 用户选择"固化版本"时，THE 协议管理系统 SHALL 显示确认对话框，说明固化后将无法修改和删除
4. IF 用户确认固化，THEN THE 协议管理系统 SHALL 更新协议的固化状态并刷新列表
5. WHEN 用户选择"解除固化"时，THE 协议管理系统 SHALL 显示确认对话框，说明解除后可以重新修改和删除
6. IF 用户确认解除固化，THEN THE 协议管理系统 SHALL 更新协议的固化状态并刷新列表
7. WHEN 协议已被固化时，THE 协议管理系统 SHALL 在更多操作菜单中隐藏删除选项

### 需求 7: 协议类型配置模板

**用户故事:** 作为管理员用户，我希望根据不同协议类型配置特定参数，以便准确定义通信协议。

#### 验收标准

1. WHEN 用户选择"以太网"协议类型时，THE 协议管理系统 SHALL 显示以太网协议配置模板组件
2. WHEN 用户选择"RS422"协议类型时，THE 协议管理系统 SHALL 显示RS422协议配置模板组件
3. WHEN 用户选择"CAN"协议类型时，THE 协议管理系统 SHALL 显示CAN协议配置模板组件
4. WHEN 用户选择"1553B"协议类型时，THE 协议管理系统 SHALL 显示1553B协议配置模板组件
5. WHEN 协议管理系统显示配置模板时，THE 协议管理系统 SHALL 在分隔线上方显示"协议格式配置"标题
6. WHEN 用户在配置模板中输入数据时，THE 协议管理系统 SHALL 将配置数据绑定到协议的protocolConfig字段
7. WHEN 用户保存协议时，THE 协议管理系统 SHALL 将协议基本信息和配置数据一起提交到后端

### 需求 8: 权限控制

**用户故事:** 作为系统管理员，我希望控制协议管理功能的访问权限，以便只有授权用户才能修改协议。

#### 验收标准

1. WHEN 用户没有"protocol:add"权限时，THE 协议管理系统 SHALL 隐藏"新增"按钮
2. WHEN 用户没有"protocol:edit"权限时，THE 协议管理系统 SHALL 隐藏"编辑"操作按钮
3. WHEN 用户没有"protocol:remove"权限时，THE 协议管理系统 SHALL 隐藏"删除"按钮
4. WHEN 用户没有"protocol:query"权限时，THE 协议管理系统 SHALL 隐藏"编辑"操作按钮
5. WHEN 用户尝试访问未授权的API端点时，THE 协议管理系统 SHALL 返回403 Forbidden响应
6. WHEN 协议管理系统检查权限时，THE 协议管理系统 SHALL 使用v-hasPermi指令进行前端权限控制

### 需求 9: 数据验证

**用户故事:** 作为用户，我希望获得清晰的验证消息，以便纠正错误并成功保存协议。

#### 验收标准

1. WHEN 用户提交没有协议名称的表单时，THE 协议管理系统 SHALL 显示错误消息"协议名称不能为空"
2. WHEN 用户提交协议名称少于2个字符的表单时，THE 协议管理系统 SHALL 显示错误消息"协议名称长度在 2 到 50 个字符"
3. WHEN 用户提交协议名称超过50个字符的表单时，THE 协议管理系统 SHALL 显示错误消息"协议名称长度在 2 到 50 个字符"
4. WHEN 用户提交没有选择协议类型的表单时，THE 协议管理系统 SHALL 显示错误消息"请选择协议类型"
5. WHEN 用户提交没有版本号的表单时，THE 协议管理系统 SHALL 显示错误消息"请输入版本号"
6. WHEN 用户提交协议描述超过200个字符的表单时，THE 协议管理系统 SHALL 显示错误消息"备注信息不能超过 200 个字符"
7. WHEN 表单验证失败时，THE 协议管理系统 SHALL 自动滚动到第一个错误字段

### 需求 10: 用户体验与视觉反馈

**用户故事:** 作为用户，我希望获得直观的视觉反馈和流畅的交互，以便高效地管理协议。

#### 验收标准

1. WHEN 协议管理系统加载数据时，THE 协议管理系统 SHALL 显示加载指示器
2. WHEN 用户执行成功操作时，THE 协议管理系统 SHALL 显示成功消息持续3秒
3. WHEN 用户执行失败操作时，THE 协议管理系统 SHALL 显示错误消息
4. WHEN 协议管理系统打开抽屉或对话框时，THE 协议管理系统 SHALL 自动聚焦第一个输入字段
5. WHEN 协议管理系统显示表格中的长文本时，THE 协议管理系统 SHALL 使用省略号截断并在悬停时显示完整文本
6. WHEN 用户在抽屉中有未保存的更改并尝试关闭时，THE 协议管理系统 SHALL 显示确认对话框
7. WHEN 协议管理系统显示协议类型时，THE 协议管理系统 SHALL 使用一致的颜色编码和图标
8. WHEN 协议管理系统执行操作时，THE 协议管理系统 SHALL 在2秒内完成响应

### 需求 11: 分页与数据加载

**用户故事:** 作为用户，我希望高效地浏览大量协议数据，以便快速找到所需信息。

#### 验收标准

1. WHEN 协议管理系统首次加载协议列表时，THE 协议管理系统 SHALL 显示第1页，每页10条记录
2. WHEN 用户更改每页显示数量时，THE 协议管理系统 SHALL 保持当前筛选条件并调整分页
3. WHEN 用户导航到不同页面时，THE 协议管理系统 SHALL 保持当前搜索和筛选条件
4. WHEN 用户执行搜索或筛选操作时，THE 协议管理系统 SHALL 重置分页到第1页
5. WHEN 协议管理系统显示分页信息时，THE 协议管理系统 SHALL 显示总记录数和当前页范围
6. WHEN 用户刷新列表时，THE 协议管理系统 SHALL 保持当前页码和筛选条件
7. WHEN 协议管理系统提供每页大小选项时，THE 协议管理系统 SHALL 提供10、20、50、100的选项

### 需求 12: 协议详情页面导航

**用户故事:** 作为管理员用户，我希望查看协议详细信息，以便深入了解协议配置。

#### 验收标准

1. WHEN 用户点击协议名称链接时，THE 协议管理系统 SHALL 导航到协议详情页面，URL格式为 "/protocol/detail/index/{protocolId}"
2. WHEN 协议管理系统导航到详情页面时，THE 协议管理系统 SHALL 在新路由中加载协议完整信息
3. WHEN 用户在详情页面点击返回时，THE 协议管理系统 SHALL 导航回协议列表页面并保持之前的筛选状态
4. WHEN 协议管理系统显示协议名称链接时，THE 协议管理系统 SHALL 使用"link-type"样式类显示为可点击链接

### 需求 13: 导出功能（预留）

**用户故事:** 作为管理员用户，我希望导出协议数据，以便进行离线分析或备份。

#### 验收标准

1. WHEN 用户点击"导出"按钮时，THE 协议管理系统 SHALL 生成包含当前筛选结果的Excel文件
2. WHEN 协议管理系统生成导出文件时，THE 协议管理系统 SHALL 使用文件名格式 "protocol_{timestamp}.xlsx"
3. WHEN 协议管理系统导出数据时，THE 协议管理系统 SHALL 包含所有可见列的数据
4. IF 导出操作失败，THEN THE 协议管理系统 SHALL 显示错误消息"导出失败，接口暂不可用"

### 需求 14: 数据持久化

**用户故事:** 作为用户，我希望我的协议配置能够可靠地保存和恢复，以便不会丢失工作成果。

#### 验收标准

1. WHEN 用户保存协议时，THE 协议管理系统 SHALL 在单个事务中持久化协议基本信息和配置数据
2. WHEN 用户重新加载协议编辑页面时，THE 协议管理系统 SHALL 准确恢复所有协议信息和配置数据
3. WHEN 用户创建新协议并保存时，THE 协议管理系统 SHALL 分配唯一的协议ID
4. WHEN 协议管理系统保存数据时，THE 协议管理系统 SHALL 自动更新最后修改时间和修改人信息
5. IF 保存操作失败，THEN THE 协议管理系统 SHALL 保留所有用户输入并允许重试而不丢失数据
6. WHEN 协议管理系统执行数据库操作时，THE 协议管理系统 SHALL 使用事务确保数据一致性

